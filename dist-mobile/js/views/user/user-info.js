define(["jquery","underscore","backbone","views/user/user-info-item","../../../common/models/user-info/user-info-model","text!templates/user/shipping-billing.html"],function(e,t,n,r,i,s){var o=Backbone.View.extend({initialize:function(){t.bindAll(this,"createSuccessCallback","createErrorCallback","updateSuccessCallback","updateErrorCallback"),this.template=t.template(s)},render:function(e){this.$el.html(this.template());var t=app.userInfoList.where({type:"S"})[0],n=app.userInfoList.where({type:"B"})[0];return t==null&&(t=new i({type:"S"}),app.userInfoList.add(t)),n==null&&(n=new i({type:"B"}),app.userInfoList.add(n)),this.shippingView=new r({model:t}),this.$("#shipping_billing .billingLft").append(this.shippingView.render().el),this.billingView=new r({model:n}),this.$("#shipping_billing .billingrht").append(this.billingView.render().el),this.el},postRender:function(){var e=app.userInfoList.where({type:"R"})[0];e!=null&&this.shippingView.populateFromModel(e)},events:{"click #proceed":"doSaveAddresses"},doSaveAddresses:function(e){e.preventDefault();if(app.utils.isAjaxLoading(e.currentTarget))return;var t=this.shippingView.isValid(),n=this.billingView.isValid();if(t===!1||n===!1){app.showError("Please correct data entry fields in error below");return}app.utils.setAjaxLoading(e.currentTarget),this.shippingView.model.get("id")==null&&this.billingView.model.get("id")==null?app.userInfoList.sync("create",app.userInfoList,{success:this.createSuccessCallback,error:this.createErrorCallback,wait:!0,url:"rest/user_info/session/list/"}):app.userInfoList.sync("update",app.userInfoList,{success:this.updateSuccessCallback,error:this.updateErrorCallback,wait:!0,url:"rest/user_info/session/list/"})},createSuccessCallback:function(t,n,r){app.utils.unsetAjaxLoading(e("#proceed")),app.userInfoList.reset(t),app.navigate("reviewCart",!0)},createErrorCallback:function(t,n,r){app.utils.unsetAjaxLoading(e("#proceed")),app.showError("Sorry, could not save your Shipping or Billing info at this time")},updateSuccessCallback:function(t,n,r){app.utils.unsetAjaxLoading(e("#proceed")),app.navigate("reviewCart",!0)},updateErrorCallback:function(t,n,r){app.utils.unsetAjaxLoading(e("#proceed")),app.showError("Sorry, could not update your Shipping or Billing info at this time")}});return o});